

<template>
  <div id="Refund">
    <List item-layout="vertical">
      <el-row v-for="(item, index) in randomMovieList" :key="index">
        <div>
          <div v-if="item.roomid == ''">
            <div>
              <el-row v-if="item.msgid != zjlift">
                <div style="">
                  <el-row>
                    <el-col :span="22"
                      ><div style="float: right">
                        <h3>{{ item.name }}</h3>
                      </div></el-col
                    >
                    <el-col :span="2"
                      ><el-image
                        style="width: 30px; height: 30px"
                        :src="item.thumb_avatar"
                      ></el-image
                    ></el-col>
                  </el-row>
                  <div
                    v-if="item.msgtype == 'text'"
                    style="
                      float: right;
                      margin-right: 10%;
                      font-size: 20px;
                      padding: 7px;
                      background-color: #58e014;
                      border-radius: 15px;
                    "
                  >
                    <!-- <ListItemMeta :avatar="avatar" :title="item.name" />       style="float: right; margin-right: 30px" -->
                    {{ item.content_s }}
                  </div>
                  <div
                    v-else-if="item.msgtype == 'video'"
                    style="float: right; margin-right: 10%"
                  >
                    <!-- <ListItemMeta :avatar="avatar" :title="item.name" /> -->
                    <video width="300" height="150" controls="" name="media">
                      >
                      <source :src="$host + item.content_s" type="video/mp4" />
                    </video>
                    <!-- {{ item.content_s }} -->
                  </div>
                  <div v-else-if="item.msgtype == 'voice'">
                    <!-- <ListItemMeta :avatar="avatar" :title="item.name" /> -->
                    <div
                      class="box"
                      v-show="!displays"
                      @click="muiscPlay1(item.content_s)"
                      style="float: right; margin-right: 10%; font-size: 20px"
                    >
                      <div class="wifi-symbol">
                        <div class="wifi-circle first"></div>
                        <div class="wifi-circle seconds"></div>
                        <div class="wifi-circle thirds"></div>
                      </div>
                    </div>
                    <div
                      class="box"
                      v-show="displays"
                      @click="muiscPlay1(item.content_s)"
                      style="float: right; margin-right: 10%; font-size: 20px"
                    >
                      <div class="wifi-symbol">
                        <div class="wifi-circle first"></div>
                        <div class="wifi-circle second"></div>
                        <div class="wifi-circle third"></div>
                      </div>
                    </div>
                    <!-- {{ item.content_s }} -->
                  </div>
                  <div
                    v-else-if="item.msgtype == 'image'"
                    style="float: right; margin-right: 10%"
                  >
                    <!-- <el-image :src="avatar"></el-image> -->
                    <!-- <ListItemMeta :avatar="avatar" :title="item.name" /> -->
                    <img
                      width="300"
                      height="150"
                      :src="$host + item.content_s"
                      type="video/mp4"
                    />
                    <!-- {{ item.content_s }} -->
                  </div>
                  <div
                    v-else-if="item.msgtype == 'file'"
                    style="float: right; margin-right: 10%"
                  >
                    <!-- <ListItemMeta :avatar="avatar" :title="item.name" /> -->

                    <a
                      :href="$host + item.content_s"
                      :download="matchcont(item.content_s)"
                      target="_blank"
                      ><el-row>
                        <el-col :span="6"
                          ><img
                            :src="require('../icons/' +matchType(item.content_s) +'.png')"
                            class="ioc-svg"
                            style="width: 8em"
                        /></el-col>
                        <el-col :span="10"
                          ><div style="margin-top: 29px; font-size: 17px">
                            {{ matchcont(item.content_s) }}
                          </div>
                        </el-col>
                      </el-row>
                    </a>
                  </div>
                </div>
              </el-row>
              <div v-else>
                <div>
                  <el-row>
                    <el-col :span="2"
                      ><el-image
                        style="width: 30px; height: 30px"
                        :src="item.thumb_avatar"
                      ></el-image
                    ></el-col>
                    <el-col :span="22"
                      ><div>
                        <h3>{{ item.name }}</h3>
                      </div></el-col
                    >
                  </el-row>
                  <div v-if="item.msgtype == 'text'">
                    <!-- <ListItemMeta :avatar="avatar" :title="item.name" /> -->
                    <div
                      v-if="item.msgtype == 'text'"
                      style="
                        margin-left: 10%;
                        font-size: 20px;
                        padding: 7px;
                        background-color: #58e014;
                        border-radius: 15px;
                        display: -webkit-inline-box;
                      "
                    >
                      <!-- <ListItemMeta :avatar="avatar" :title="item.name" />       style="float: right; margin-right: 30px" -->
                      {{ item.content_s }}
                    </div>
                  </div>
                  <div v-else-if="item.msgtype == 'video'">
                    <!-- <ListItemMeta :avatar="avatar" :title="item.name" /> -->

                    <video
                      width="300"
                      height="150"
                      controls=""
                      name="media"
                      style="margin-left: 10%; font-size: 20px"
                    >
                      <source :src="$host + item.content_s" type="video/mp4" />
                    </video>
                  </div>
                  <div v-else-if="item.msgtype == 'voice'">
                    <!-- <ListItemMeta :avatar="avatar" :title="item.name" /> -->
                    <div
                      class="box"
                      v-show="!displays"
                      @click="muiscPlay1(item.content_s)"
                    >
                      <div class="wifi-symbol">
                        <div class="wifi-circle first"></div>
                        <div class="wifi-circle seconds"></div>
                        <div class="wifi-circle thirds"></div>
                      </div>
                    </div>
                    <div
                      class="box"
                      v-show="displays"
                      @click="muiscPlay1(item.content_s)"
                    >
                      <div class="wifi-symbol">
                        <div class="wifi-circle first"></div>
                        <div class="wifi-circle second"></div>
                        <div class="wifi-circle third"></div>
                      </div>
                    </div>
                  </div>
                  <div v-else-if="item.msgtype == 'image'">
                    <!-- <ListItemMeta :avatar="avatar" :title="item.name" /> -->

                    <img
                      width="300"
                      height="150"
                      :src="$host + item.content_s"
                      type="video/mp4"
                      style="margin-left: 10%"
                    />
                  </div>
                  <div v-else-if="item.msgtype == 'flie'">
                    <!-- <ListItemMeta :avatar="avatar" :title="item.name" /> -->

                    <a
                      :href="$host + item.content_s"
                      :download="matchcont(item.content_s)"
                      target="_blank"
                      ><el-row>
                        <el-col :span="6"
                          ><img
                            :src="
                              require('../icons/' +
                                matchType(item.content_s) +
                                '.png')
                            "
                            class="ioc-svg"
                            style="width: 8em"
                        /></el-col>
                        <el-col :span="10"
                          ><div style="margin-top: 29px; font-size: 17px">
                            {{ matchcont(item.content_s) }}
                          </div>
                        </el-col>
                      </el-row>
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div v-else>
            <div>
              <el-row v-if="item.from_s != zjlift">
                <div style="">
                  <el-row>
                    <el-col :span="22"
                      ><div style="float: right">
                        <h3>{{ item.name }}</h3>
                      </div></el-col
                    >
                    <el-col :span="2"
                      ><el-image
                        style="width: 30px; height: 30px"
                        :src="item.thumb_avatar"
                      ></el-image
                    ></el-col>
                  </el-row>
                  <div
                    v-if="item.msgtype == 'text'"
                    style="
                      float: right;
                      margin-right: 10%;
                      font-size: 20px;
                      padding: 7px;
                      background-color: #58e014;
                      border-radius: 15px;
                    "
                  >
                    <!-- <ListItemMeta :avatar="avatar" :title="item.name" />       style="float: right; margin-right: 30px" -->
                    {{ item.content_s }}
                  </div>
                  <div
                    v-else-if="item.msgtype == 'video'"
                    style="float: right; margin-right: 10%"
                  >
                    <!-- <ListItemMeta :avatar="avatar" :title="item.name" /> -->
                    <video width="300" height="150" controls="" name="media">
                      >
                      <source :src="$host + item.content_s" type="video/mp4" />
                    </video>
                    <!-- {{ item.content_s }} -->
                  </div>
                  <div v-else-if="item.msgtype == 'voice'">
                    <!-- <ListItemMeta :avatar="avatar" :title="item.name" /> -->
                    <div
                      class="box"
                      v-show="!displays"
                      @click="muiscPlay1(item.content_s)"
                      style="float: right; margin-right: 10%; font-size: 20px"
                    >
                      <div class="wifi-symbol">
                        <div class="wifi-circle first"></div>
                        <div class="wifi-circle seconds"></div>
                        <div class="wifi-circle thirds"></div>
                      </div>
                    </div>
                    <div
                      class="box"
                      v-show="displays"
                      @click="muiscPlay1(item.content_s)"
                      style="float: right; margin-right: 10%; font-size: 20px"
                    >
                      <div class="wifi-symbol">
                        <div class="wifi-circle first"></div>
                        <div class="wifi-circle second"></div>
                        <div class="wifi-circle third"></div>
                      </div>
                    </div>
                    <!-- {{ item.content_s }} -->
                  </div>
                  <div
                    v-else-if="item.msgtype == 'image'"
                    style="float: right; margin-right: 10%"
                  >
                    <!-- <el-image :src="avatar"></el-image> -->
                    <!-- <ListItemMeta :avatar="avatar" :title="item.name" /> -->
                    <img
                      width="300"
                      height="150"
                      :src="$host + item.content_s"
                      type="video/mp4"
                    />
                    <!-- {{ item.content_s }} -->
                  </div>
                  <div v-else-if="item.msgtype == 'file'" style="float: right">
                    <!-- <ListItemMeta :avatar="avatar" :title="item.name" /> -->

                    <a
                      :href="$host + item.content_s"
                      :download="matchcont(item.content_s)"
                      target="_blank"
                      ><el-row>
                        <el-col :span="12"
                          ><img
                            :src="
                              require('../icons/' +
                                matchType(item.content_s) +
                                '.png')
                            "
                            class="ioc-svg"
                            style="width: 8em"
                        /></el-col>
                        <el-col :span="10"
                          ><div style="margin-top: 29px; font-size: 17px">
                            {{ matchcont(item.content_s) }}
                          </div>
                        </el-col>
                      </el-row>
                    </a>
                  </div>
                </div>
              </el-row>
              <div v-else>
                <div>
                  <el-row>
                    <el-col :span="2"
                      ><el-image
                        style="width: 30px; height: 30px"
                        :src="item.thumb_avatar"
                      ></el-image
                    ></el-col>
                    <el-col :span="22"
                      ><div>
                        <h3>{{ item.name }}</h3>
                      </div></el-col
                    >
                  </el-row>
                  <div v-if="item.msgtype == 'text'">
                    <!-- <ListItemMeta :avatar="avatar" :title="item.name" /> -->
                    <div
                      v-if="item.msgtype == 'text'"
                      style="
                        margin-left: 10%;
                        font-size: 20px;
                        padding: 7px;
                        background-color: #58e014;
                        border-radius: 15px;
                        display: -webkit-inline-box;
                      "
                    >
                      <!-- <ListItemMeta :avatar="avatar" :title="item.name" />       style="float: right; margin-right: 30px" -->
                      {{ item.content_s }}
                    </div>
                  </div>
                  <div v-else-if="item.msgtype == 'video'">
                    <!-- <ListItemMeta :avatar="avatar" :title="item.name" /> -->

                    <video
                      width="300"
                      height="150"
                      controls=""
                      name="media"
                      style="margin-left: 10%; font-size: 20px"
                    >
                      <source :src="$host + item.content_s" type="video/mp4" />
                    </video>
                  </div>
                  <div v-else-if="item.msgtype == 'voice'">
                    <!-- <ListItemMeta :avatar="avatar" :title="item.name" /> -->
                    <div
                      class="box"
                      v-show="!displays"
                      @click="muiscPlay1(item.content_s)"
                    >
                      <div class="wifi-symbol">
                        <div class="wifi-circle first"></div>
                        <div class="wifi-circle seconds"></div>
                        <div class="wifi-circle thirds"></div>
                      </div>
                    </div>
                    <div
                      class="box"
                      v-show="displays"
                      @click="muiscPlay1(item.content_s)"
                    >
                      <div class="wifi-symbol">
                        <div class="wifi-circle first"></div>
                        <div class="wifi-circle second"></div>
                        <div class="wifi-circle third"></div>
                      </div>
                    </div>
                  </div>
                  <div v-else-if="item.msgtype == 'image'">
                    <!-- <ListItemMeta :avatar="avatar" :title="item.name" /> -->

                    <img
                      width="300"
                      height="150"
                      :src="$host + item.content_s"
                      type="video/mp4"
                      style="margin-left: 10%"
                    />
                  </div>
                  <div v-else-if="item.msgtype == 'flie'">
                    <!-- <ListItemMeta :avatar="avatar" :title="item.name" /> -->

                    <a
                      :href="$host + item.content_s"
                      :download="matchcont(item.content_s)"
                      target="_blank"
                      ><el-row>
                        <el-col :span="6"
                          ><img
                            :src=" require('../icons/'+matchType(item.content_s) +'.png')
                            "
                            class="ioc-svg"
                            style="width: 8em"
                        /></el-col>
                        <el-col :span="10"
                          ><div style="margin-top: 29px; font-size: 17px">
                            {{ matchcont(item.content_s) }}
                          </div>
                        </el-col>
                      </el-row>
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </el-row>
    </List>
    <div class="icons"></div>
    <!-- <div class="audio" @click="play('http://localhost:52922/voice/mario.amr')">
      <h3>点击收听留言</h3>
    </div> -->
  </div>
</template>
<script>
// import helper from '../utils/helper'
// import store from '../vuex/store'
// import BenzAMRRecorder from 'benz-amr-recorder'

export default {
  data() {
    return {
      zjlift: "",
      gamemuiscs1: "",
      displays: false,
      inputmodel: "",
      iconFlag: false,
      loading: false,
      noncestr: "",
      randomMovieList: [],
      avatar:
        "https://dev-file.iviewui.com/userinfoPDvn9gKWYihR24SpgC319vXY8qniCqj4/avatar",
    };
  },
  created() {
    this.handleSubm;
    var params = this.Storage.Session.get("datas");
    this.zjlift = params.id;
    //  this.pofang()
    if (params.roomid == "") {
      this.DeisSelectsUser(params.id, params.id1);
    } else {
      this.DeisSelectsUserGroup(params.roomid);
    }
    //alert(123);
  },
   watch: {
        "displays": function(newVal, oldVal) {
            // TO DO
            console.log("newVal:", newVal);
            console.log("oldVal:", oldVal);
        }
    },
  methods: {
    matchcont(columnEntity) {
      let index = columnEntity.lastIndexOf("\\");
      columnEntity = columnEntity.substring(index + 1, columnEntity.length);
      return columnEntity;
    },
    matchType(fileName) {
      //alert(fileName);
      //后缀获取
      var suffix = ""; //获取类型结果
      var result = "";
      try {
        var flieArr = fileName.substring(
          fileName.indexOf(".") + 1,
          fileName.length
        );
      } catch (err) {
        suffix = "";
      }
      console.log(flieArr);
      return flieArr;
    },

    //试听游戏音乐
    muiscPlay1(val) {
      //alert("123");

      this.iconFlag = !this.iconFlag; // 这个变量是控制播放与否的
      console.log(this.iconFlag);
      if (this.iconFlag) {
        this.gamemuiscs1 = new Audio(this.$host + val);
        this.gamemuiscs1.play();
        this.displays = true;
      } else {
        console.info(this.gamemuiscs1.pause());
        this.gamemuiscs1.pause();
        this.displays = false;
      }

      this.gamemuiscs1.addEventListener(
        "ended",
        function () {
          //alert("b播放完成");
         // this.gamemuiscs1.pause()
          this.displays = false;
          this.iconFlag = false;
          console.log(this.iconFlag);
          //alert(this.iconFlag);
        },
        false
      );
      //alert(this.displays)
    },
    play(url) {
      var BenzAMRRecorder = require("benz-amr-recorder");
      var amr = new BenzAMRRecorder();

      amr.initWithUrl(url).then(function () {
        console.log(amr.getDuration()); //获取音频总时长
        // if (this.iconFlag) {  // play
        amr.play();
        // } else {      // stop
        //     amr.stop();

        // }
      });
      //监听播放完成
      amr.onEnded(function () {
        console.log(this.iconFlag);
        //alert("播放完毕");
        this.iconFlag = false;
      });
    },
    DeisSelectsUser(val, vbl) {
      let that = this;
      const url =
        "api/wxpay/HuiHuas?from_s=" + val + "&tolist=" + vbl + "&api-version=1";
      that.Ajax.get(url).then(function (res) {
        that.randomMovieList = res.data;
        console.info(that.randomMovieList);
      });
    },
    DeisSelectsUserGroup(val) {
      let that = this;
      const url = "api/wxpay/GetGroupMessage?roomid=" + val + "&api-version=1";
      that.Ajax.get(url).then(function (res) {
        that.randomMovieList = res.data;
        console.info(that.randomMovieList);
      });
    },

    // pofang(){
    //   var amr = new BenzAMRRecorder();
    //   amr.initWithUrl('voice/mario.amr').then(function() {
    //     amr.play();
    //   });
    //   amr.onEnded(function() {
    //     alert('播放完毕');
    //   })
    // }
  },
};
</script>
<style scoped>
li {
  list-style-type: none;
}
* {
  margin: 0;
  padding: 0;
}
.box {
  box-sizing: border-box;
  position: relative;
  margin: 0 30px;
}
.wifi-symbol {
  width: 50px;
  height: 50px;
  box-sizing: border-box;
  overflow: hidden;
  transform: rotate(135deg);
}
.wifi-circle {
  border: 5px solid #999999;
  border-radius: 50%;
  position: absolute;
}

.first {
  width: 5px;
  height: 5px;
  background: #cccccc;
  top: 45px;
  left: 45px;
}
.seconds {
  width: 25px;
  height: 25px;
  top: 35px;
  left: 35px;
  /* animation: fadeInOut 1s infinite 0.2s; */
}
.second {
  width: 25px;
  height: 25px;
  top: 35px;
  left: 35px;
  animation: fadeInOut 1s infinite 0.2s;
}

.thirds {
  width: 40px;
  height: 40px;
  top: 25px;
  left: 25px;
  /* animation: fadeInOut 1s infinite 0.4s; */
}
.third {
  width: 40px;
  height: 40px;
  top: 25px;
  left: 25px;
  animation: fadeInOut 1s infinite 0.4s;
}

@keyframes fadeInOut {
  0% {
    opacity: 0; /*初始状态 透明度为0*/
  }
  100% {
    opacity: 1; /*结尾状态 透明度为1*/
  }
}
</style>
