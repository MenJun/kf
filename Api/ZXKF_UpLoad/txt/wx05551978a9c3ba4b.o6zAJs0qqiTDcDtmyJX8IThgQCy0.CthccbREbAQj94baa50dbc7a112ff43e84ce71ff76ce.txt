[HttpPost]
        [Route("upload/service")]
        public Response UploadServiceImg()
        {
            return WxappService.UploadServiceImg(); 
        }

public Response UploadServiceImg()
        {
            var files = HttpContext.Current.Request.Files;
            var form = HttpContext.Current.Request.Form;
            CustomerServiceMessage customerService = new CustomerServiceMessage
            {
                MsgType = form["msgType"],
                FromUserName = form["fromUserName"],
                ToUserName = form["toUserName"],
                Content = "",
                AppId = "",
                CreateTime = TimeStampHelper.ToTimeStamp(DateTime.Now)
            };

            string basePath = AppDomain.CurrentDomain.BaseDirectory;

            string filePath = SERVICE_IMG_PATH + DateTime.Now.ToString("yyyyMMdd");
            int limitFileSize = 1024 * 1024 * 2;

            string fullPath = basePath + filePath;
            string savePath = "";

            //如果目录不存在，则创建目录
            if (!Directory.Exists(fullPath))
            {
                Directory.CreateDirectory(fullPath);
            }

            if (files.Count > 0)
            {
                foreach (var key in files.AllKeys)
                {
                    var file = files[key];
                    //校验文件类型
                    string fileExtension = Path.GetExtension(file.FileName);
                    string fileMimeType = MimeMapping.GetMimeMapping(file.FileName);
                    string[] fileTypeWhiteList = new string[] { ".jpg", ".jpeg", ".png" };
                    string[] fileMimeTypeWhiteList = new string[] { "image/jpg", "image/jpeg", "image/png" };
                    if (!fileTypeWhiteList.Contains(fileExtension.ToLower()) || !fileMimeTypeWhiteList.Contains(fileMimeType))
                    {
                        throw new Exception($"文件{file.FileName}是不支持的文件类型！");
                    }

                    if (file.ContentLength > limitFileSize)
                    {
                        throw new Exception($"文件{file.FileName}超出大小限制，请处理后上传！");
                    }

                    if (!string.IsNullOrEmpty(file.FileName))
                    {
                        string fileName = Guid.NewGuid().ToString("N") + Path.GetExtension(file.FileName);
                        savePath = filePath + "/" + fileName;
                        file.SaveAs(fullPath + "/" + fileName);

                        var token = WxHelper.GetAccessToken(AppId, Secret);
                        var mediaId = TencentHelper.UploadTempMedia(token, fullPath + "/" + fileName);
                        customerService.MediaId = mediaId;
                        customerService.Image = new
                        {
                            media_id = mediaId
                        };
                        customerService.PicUrl = savePath;
                        WxappDao.SaveCustomerMessage(customerService);

                        TencentHelper.SendCustomerMessageToUser(token, TencentHelper.MSG_TYPE_IMG, string.Empty, mediaId, customerService.ToUserName);
                    }
                }
                return new Response
                {
                    Result = savePath
                };
            }
            else
            {
                throw new Exception("上传失败，未接收到请求文件！");
            }
        }
